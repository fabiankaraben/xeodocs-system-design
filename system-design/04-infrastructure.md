---
title: Infrastructure & Deployment
description: The system runs on Kubernetes, leveraging a GitOps approach.
---

The system runs on Kubernetes, leveraging a GitOps approach.

## Kubernetes Architecture

The system runs on Kubernetes, leveraging a GitOps approach.

### Namespace Strategy
- `xeodocs-system`: Core services, workers, database (if internal).
- `argocd`: Argo CD deployment.
- `monitoring`: Prometheus, Grafana.
- `ingress-nginx`: Ingress controller.

### Components
- **Ingress Controller:** Nginx or Traefik.
- **Cert Manager:** For automatic SSL (Let's Encrypt).
- **Storage Class:**
    - **Production (AWS/OVH):** GP3 (AWS) or Cinder (OVH) for high-performance I/O (Git operations).
    - **Local:** LocalPath or K3s default.
- **Secrets:** **Infisical** (via Sidecar or Operator) to inject secrets (DB credentials, API Keys) into Pods.

## GitOps Workflow (Argo CD)

We use **Argo CD** to sync the state of the cluster with the `xeodocs-k8s` repository.

**Repository Structure (`xeodocs-k8s`):**
```
/base
  /auth-service
  /core-service
  /git-worker
  /postgres
  /rabbitmq
/overlays
  /dev  (patches for local/remote dev)
  /prod (patches for production)
```

**Deployment Pipeline:**
1. **Code Change:** Developer pushes to `xeodocs-backend`.
2. **CI (GitHub Actions):**
   - Run Tests.
   - Build Docker Images.
   - Push to Container Registry (GHCR / AWS ECR).
3. **Update Manifests:** CI script updates the image tag in `xeodocs-k8s/overlays/prod/kustomization.yaml`.
4. **Argo CD:** Detects drift and syncs the cluster.

## Local Development

For local development, we simulate the production environment using **K3D** (or Kind) and **Tilt**.

**Tools:**
- **K3D:** Lightweight local K8s cluster.
- **Tilt:** Watch files -> Build Image -> Push to Local Registry -> Update K8s deployment live.
- **Infisical CLI:** To inject secrets locally.

**Tiltfile Example Logic:**
1. Start K8s resources (YAMLs generated by `kustomize build overlays/dev`).
2. Watch Go files.
3. On change: rebuild binary/image and live-update the running container.

## External Dependencies
- **PostgreSQL:** Managed RDS/CloudSQL or StatefulSet in K8s (with PVC).
- **RabbitMQ:** High-availability RabbitMQ cluster or Cloud offering.
